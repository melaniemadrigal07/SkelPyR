# SkelPyR

**SkelPyR** provides R-based tools for analyzing JSON output files produced by the SkelPy/HyPhy fungal skeletonization GUI.  
It processes these JSON files into spatial network objects and computes hyphal-level, node-level, and edge-level metrics.  
The main user-facing function is `run_fyskel_pipeline()`, which performs the end-to-end analysis workflow.

---

## Installation

Install the development version from GitHub:

    install.packages("devtools")
    devtools::install_github("melaniemadrigal07/SkelPyR")

---

## Loading the Package

Load SkelPy into your R session with:

    library(SkelPyR)

This must be run each time you start a new R session.

---
## Example Data
SkelPyR includes a small example dataset derived from real SkelPy/HyPhy output.  
This dataset is bundled inside the package under:

    inst/extdata/calculations_example/

These files contain minimal JSON skeletons that allow users and reviewers to  
run the entire pipeline without needing external data.

You can access the example data with:

    example_dir <- system.file("extdata", "calculations_example", package = "SkelPyR")
    list.files(example_dir)


## Quick Usage Example

Process a single JSON file manually:

    library(jsonlite)
    library(SkelPyR)

    x <- fromJSON("path/to/sample_calculations.json")
    network <- eRgot(x)   # or safe_eRgot("file.json")
    print(network)

---

## Full Pipeline: Processing an Entire Folder

To process all JSON files generated by SkelPy/HyPhy:

    results <- run_fyskel_pipeline()

If no folder is provided, a folder-selection dialog will appear (when RStudio is available).

You may also specify paths directly:

    results <- run_fyskel_pipeline(
        base_dir   = "path/to/jsons",
        output_dir = "path/to/output"
    )

### The pipeline performs:

1. Folder selection or manual path loading  
2. Safe execution of `eRgot()` on each file  
3. Cleaning and reconstruction of hyphal networks  
4. Computation of:
   - Cleaning summaries  
   - Node-level metrics  
   - Edge-level metrics  
   - Hyphal-level metrics  
5. Saving outputs to CSV  
6. Saving cleaned hyphae plots to `plots_json/`  

---

## Output Files Generated

Upon completion, SkelPyR writes the following files to the output directory:

    cleaning_summary_hyphae.csv
    node_level_metrics_hyphae.csv
    edge_level_metrics_hyphae.csv
    hyphae_network_summary.csv
    plots_json/   # folder containing cleaned hyphae plots

---

## Returned Object Structure

The function returns a list containing:

    results$network_results   # processed network objects (one per file)
    results$json_files        # file paths
    results$base_dir          # input directory
    results$output_dir        # output directory

Example:

    names(results$network_results)

---

### Structure of each sample entry

    results$network_results[["sample.json"]]
    ├── raw_data          # raw JSON as parsed
    ├── sf_unclean        # unclean spatial edges + nodes
    ├── unclean_maps      # diagnostic plots (3)
    ├── clean_maps        # cleaned maps (3)
    ├── network_plots     # 6-panel patchwork visualization
    ├── network_sclerotia # sclerotia network objects
    └── network_hyphae    # hyphal network objects

---

## Accessing Individual Components

Select a sample:

    sample <- results$network_results[[1]]

Access cleaned hyphal network:

    sample$network_hyphae$clean_net

Access node-level metrics for that sample:

    sample$network_hyphae$clean_net %>% 
        activate(nodes) %>%
        as_tibble()

Access edge-level metrics:

    sample$network_hyphae$clean_net %>%
        activate(edges) %>%
        as_tibble()

---

## Visualizing a Skeletonized Network

    library(ggplot2)

    ggplot() +
        geom_sf(data = sample$network_hyphae$clean_net) +
        theme_minimal()

---

## Input File Requirements

SkelPyR expects SkelPy/HyPhy JSON files with structure:

- pixel-to-coordinate mappings  
- hyphae and sclerotia skeleton arrays  
- node/edge connectivity  
- metrics produced by the GUI  

These files typically end in:

    *_calculations.json

---

## Package Structure

    SkelPyR/
      R/                   # Core functions (FySkel pipeline)
      man/                 # Documentation
      inst/extdata/        # Optional example JSONs
      DESCRIPTION
      NAMESPACE
      README.md

---

## Issues & Contributions

If you encounter a bug or would like to request features, please email melaniemadrigal007@gmail.com

---


